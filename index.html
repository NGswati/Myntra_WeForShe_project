<!DOCTYPE html>
<html lang="en">

<head>
    <title>Myntra Functional Clone</title>
    <link rel="stylesheet" href="css/index.css" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        /* Additional styles for the negotiate button and popup */
        /* Container for the entire product detail section */

        .product-detail-container {
            display: flex;
            justify-content: center;
            /* Center horizontally */
            align-items: center;
            /* Center vertically */
            padding: 20px;
            background-color: white;
            border: 1px solid #e0e0e0;
            margin: 20px;
        }

        .product-info {
            max-width: 500px;
            text-align: center;
            /* Center text content */
            padding: 20px;
            /* Add padding for spacing */
        }

        /* Style for the product images */
        .product-image img {
            width: 600px;
            /* Increase the width to enlarge the image */
            height: auto;
        }



        /* Title styling */
        .product-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* Company name styling */
        .company-name {
            font-size: 18px;
            color: #757575;
            margin-bottom: 10px;
        }

        /* Rating section */
        .rating {
            font-size: 16px;
            color: #ff3e6c;
            margin-bottom: 10px;
        }

        /* Price section */
        .price {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .current-price {
            font-weight: bold;
            color: #ff3e6c;
        }

        .original-price {
            text-decoration: line-through;
            color: #b0b0b0;
            margin-left: 10px;
        }

        .discount {
            color: #ff3e6c;
            margin-left: 10px;
        }

        /* Description styling */
        .description {
            font-size: 16px;
            color: #757575;
            margin-bottom: 20px;
        }

        /* Add to Bag button */
        .btn-add-bag {
            background-color: #ff3e6c;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        /* Negotiate button */
        .negotiate-btn {
            background-color: #757575;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        .negotiate-btn:hover {
            background-color: #ff3e6c;
            border: 1px solid gold;
            border-radius: %;

            padding: 12px 22px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        /* Popup for negotiation */
        .popup {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .popup-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        #negotiationHistory {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        /* Updated styles for the items container to enable horizontal scrolling */
        .items-container {
            display: flex;
            overflow-x: auto;
            /* Enable horizontal scrolling */
            margin-top: 20px;
            padding-bottom: 20px;
            /* Add padding for better visual separation */
            border-bottom: 1px solid #ddd;
            /* Add a bottom border for separation */
            white-space: nowrap;
            /* Prevent items from wrapping */
        }

        .similar-item {
            flex: 0 0 auto;
            /* Prevent items from shrinking */
            margin-right: 20px;
            /* Add spacing between items */
        }

        .similar-item:last-child {
            margin-right: 0;
            /* Remove right margin from the last item */
        }
    </style>
</head>

<body>
    <header>
        <div class="logo_container" id="logo_container">
            <a href="/inde"><img class="myntra_home" src="images/myntra_logo.webp" alt="Myntra Home" /></a>
        </div>
        <nav class="nav_bar">
            <a href="/inde">Men</a>
            <a href="/inde">Women</a>
            <a href="/inde">Kids</a>
            <a href="/inde">Home & Living</a>
            <a href="#">Beauty</a>
            <a href="/dashboard">Studio <sup>New</sup></a>
        </nav>
        <div class="search_bar">
            <span class="material-symbols-outlined search_icon">search</span>
            <input class="search_input" placeholder="Search for products, brands and more" />
        </div>
        <div class="action_bar">
            <div class="action_container">
                <span class="material-symbols-outlined action_icon">person</span>
                <span class="action_name">Profile</span>
            </div>
            <div class="action_container">
                <span class="material-symbols-outlined action_icon">favorite</span>
                <span class="action_name">Wishlist</span>
            </div>
            <a class="action_container" href="/bag">
                <span class="material-symbols-outlined action_icon">shopping_bag</span>
                <span class="action_name">Bag</span>
                <span class="bag-item-count">0</span>
            </a>
        </div>
    </header>

    <main>
        <div class="product-detail-container"></div>
        <!-- <div class="product-container">
            <div class="product-details">
                <h1 class="product-title">Product Title</h1>
                <p class="product-brand">Brand Name</p>
                <div class="rating"></div>
                <p class="price"><span class="current-price">₹999</span> <span class="original-price">₹1,999</span>
                    <span class="discount-percentage">50% OFF</span>
                </p>
                <button class="negotiate-btn" onclick="openNegotiation()">Negotiate Price</button>
                <p class="description">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam scelerisque felis
                    eu sem scelerisque, eu facilisis tortor volutpat.</p>
            </div>
        </div> -->

        <div id="negotiationPopup" class="popup">
            <div class="popup-content">
                <span class="close" onclick="closeNegotiation()">&times;</span>
                <h2>AI Price Negotiation</h2>
                <p>Current Price: ₹<span id="currentPrice"></span></p>
                <input type="number" id="userOffer" placeholder="Enter your offer">
                <select id="negotiationArgument">
                    <option value="">Select an argument</option>
                    <option value="highSoTD">I have high SoTD count</option>
                    <option value="loyalCustomer">I'm a loyal customer</option>
                    <option value="creditPoints">I have many credit points</option>
                    <option value="bulkPurchase">I'm making a bulk purchase</option>
                </select>
                <button onclick="submitOffer()">Submit Offer</button>
                <button id="finalizePurchase" onclick="finalizePurchase()" style="display: none;">Finalize
                    Purchase</button>
                <div id="negotiationHistory"></div>
            </div>
        </div>

        <h1>Similar products</h1>
        <div class="items-container"></div>
    </main>
    <footer>
        <div class="footer_container">
            <div class="footer_column">
                <h3>ONLINE SHOPPING</h3>
                <a href="#">Men</a>
                <a href="#">Women</a>
                <a href="#">Kids</a>
                <a href="#">Home & Living</a>
                <a href="#">Beauty</a>
                <a href="#">Gift Card</a>
                <a href="#">Myntra Insider</a>
            </div>
            <div class="footer_column">
                <h3>ONLINE SHOPPING</h3>
                <a href="#">Men</a>
                <a href="#">Women</a>
                <a href="#">Kids</a>
                <a href="#">Home & Living</a>
                <a href="#">Beauty</a>
                <a href="#">Gift Card</a>
                <a href="#">Myntra Insider</a>
            </div>
            <div class="footer_column">
                <h3>ONLINE SHOPPING</h3>
                <a href="#">Men</a>
                <a href="#">Women</a>
                <a href="#">Kids</a>
                <a href="#">Home & Living</a>
                <a href="#">Beauty</a>
                <a href="#">Gift Card</a>
                <a href="#">Myntra Insider</a>
            </div>
        </div>
        <hr />
        <div class="copyright">
            © 2024 www.myntra.com. All rights reserved.
        </div>
    </footer>


    <script>

        document.addEventListener('DOMContentLoaded', function () {
            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[[\]]/g, '\\$&');
                var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, ' '));
            }

            var itemId = getParameterByName('id');
            var products = [
                {
                    id: 4,
                    image: 'images/4.jpg',
                    rating: { stars: 4, count: 120 },
                    company: 'Apple',
                    item_name: 'Macbook1',
                    current_price: 79999,
                    original_price: 111999,
                    discount: 40,
                    description: 'Finest of all.'
                }]

            function displayProductDetails(itemId) {
                var productDetailContainer = document.querySelector('.product-detail-container');
                if (!productDetailContainer) return;

                var product = items.find(item => item.id == itemId);
                if (product) {
                    var innerHtml = `
                <div class="product-image">
                    <img src="${product.image}" alt="${product.item_name}">
                </div>
                <div class="product-info">
                    <h1 class="product-title">${product.item_name}</h1>
                    <div class="rating">${product.rating.stars} ⭐ | ${product.rating.count}</div>
                    <div class="company-name">${product.company}</div>
                    <div class="price">
                        <span class="current-price">Rs ${product.current_price}</span>
                        <span class="original-price">Rs ${product.original_price}</span>
                        <span class="discount">(${product.discount}% OFF)</span>
                    </div>
                    <p class="description">${product.description}</p>
                    <button class="btn-add-bag" onclick="addToBag(${product.id})">Add to Bag</button>
                    <button class="negotiate-btn" onclick="openNegotiation()">Negotiate Price</button>
                </div>`;
                    productDetailContainer.innerHTML = innerHtml;
                    document.getElementById('currentPrice').innerText = product.current_price;
                    return true;
                }
                return false;
            }

            if (!displayProductDetails(itemId)) {
                displayProductDetails(products[0].id);
            }
        });

        function addToBag(itemId) {
            bagItems.push(itemId);
            localStorage.setItem('bagItems', JSON.stringify(bagItems));
            displayBagIcon();
        }

        function openNegotiation() {
            document.getElementById('negotiationPopup').style.display = 'block';
        }

        function closeNegotiation() {
            document.getElementById('negotiationPopup').style.display = 'none';
        }



        function submitOffer() {
            const userOffer = document.getElementById('userOffer').value;
            const argument = document.getElementById('negotiationArgument').value;

            if (!userOffer || !argument) {
                alert('Please enter your offer and select an argument.');
                return;
            }

            const data = {
                productId: '004',
                userId: 3,
                userOffer: parseFloat(userOffer),
                argument: argument
            };

            fetch('/api/negotiate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    const negotiationHistory = document.getElementById('negotiationHistory');
                    const currentContent = negotiationHistory.innerHTML;

                    negotiationHistory.innerHTML = `
                        <p>${data.response}</p>
                        <p>Final Price: ₹${data.finalPrice}</p>
                        <hr>
                        ${currentContent}`;
                    document.getElementById('currentPrice').innerText = data.finalPrice;
                    document.getElementById('finalizePurchase').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred during negotiation.');
                });
        }


        function finalizePurchase() {
            const productId = '004';
            const userId = 3;
            const finalPrice = document.getElementById('currentPrice').innerText;

            const data = {
                productId,
                userId,
                finalPrice: parseFloat(finalPrice)
            };

            fetch('/api/finalize-purchase', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    closeNegotiation();
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while finalizing the purchase.');
                });
        }
    </script>
    <script src="data/items.js"></script>
    <script src="scripts/index.js"></script>
    <script src="scripts/carousel.js"></script>
</body>

</html>